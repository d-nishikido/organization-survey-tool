# 実装計画

## 概要

従業員ダッシュボード機能を段階的に実装します。LocalStorageベースのセッション管理により完全匿名性を保ちながら、調査の回答状態を追跡し、従業員が未回答の調査を見逃さず完了できる機能を提供します。

---

- [ ] 1. LocalStorageセッション管理システムを構築
- [x] 1.1 セッション管理の基盤機能を実装
  - 調査の回答状態を追跡するSessionManagerクラスを作成
  - LocalStorageへのデータ保存と読み込み機能を実装
  - セッション情報のJSON形式でのシリアライズ・デシリアライズ
  - LocalStorage利用不可時のエラーハンドリングとフォールバック
  - _要件: 1.5, 2.4_

- [x] 1.2 セッション管理の補助機能を実装
  - 特定の調査IDの完了状態を確認する機能
  - 調査を完了済みとしてマークする機能
  - 30日以上アクセスのないセッションデータのクリーンアップ
  - JSONパース失敗時のエラーハンドリング
  - _要件: 1.5, 2.3, 2.4_

- [ ] 2. ダッシュボードのデータ取得ロジックを実装
- [x] 2.1 調査データと回答状態を統合するカスタムフックを作成
  - React Queryを使用した公開中調査一覧の取得
  - SessionManagerとの連携で各調査の回答状態を取得
  - 調査データと回答状態を統合したSurveyWithStatus型の生成
  - 期限が3日以内の調査を判定する機能（date-fns使用）
  - _要件: 1.1, 1.2, 1.4, 1.5_

- [x] 2.2 統計情報の計算とキャッシング最適化
  - 全体調査数と回答済み調査数の集計
  - 回答完了率のパーセンテージ計算
  - useMemoによる統計情報の計算結果メモ化
  - React Queryのキャッシュ設定（staleTime: 5分、refetchOnWindowFocus）
  - エラーステートとローディングステートの管理
  - _要件: 3.1, 3.2, 6.1, 6.2_

- [ ] 3. 統計情報表示コンポーネントを作成
- [x] 3.1 統計カードの基本UI実装
  - DashboardStatsCardコンポーネントの作成
  - 全体調査数と回答済み調査数の表示
  - 回答完了率のパーセンテージ表示
  - Tailwind CSSによるカードレイアウトとスタイリング
  - _要件: 3.1, 3.2_

- [x] 3.2 進捗可視化とローディング状態の実装
  - プログレスバーによる完了率の視覚的表現
  - 全調査完了時の祝福メッセージと感謝メッセージ
  - ローディング状態のスケルトンUI
  - レスポンシブデザイン（モバイル・タブレット・デスクトップ）
  - _要件: 3.3, 3.4, 6.2_

- [ ] 4. 調査カード表示コンポーネントを拡張・作成
- [x] 4.1 既存SurveyCardコンポーネントを拡張
  - isCompletedプロップの追加と回答済みバッジの表示
  - isDeadlineNearプロップの追加と期限警告バッジの表示
  - 回答済み調査の視覚的区別（低透明度、クリック無効化）
  - variantプロップによるコンパクト表示オプション
  - _要件: 1.2, 1.4, 2.2_

- [x] 4.2 調査カードリストコンポーネントを作成
  - SurveyCardListコンポーネントの作成
  - レスポンシブグリッドレイアウト（モバイル1列、タブレット2列、デスクトップ3列）
  - 調査カードクリック時のコールバック処理
  - 空状態メッセージのカスタマイズ対応
  - ローディング状態のスケルトンUI
  - _要件: 1.1, 1.2, 5.1, 5.2, 5.3_

- [ ] 5. メインダッシュボードページを実装
- [x] 5.1 ダッシュボードページの基本構造を構築
  - EmployeeDashboardPageコンポーネントの作成
  - EmployeeLayoutとの統合
  - useDashboardDataフックとのデータ連携
  - ローディング状態、エラー状態、空状態のハンドリング
  - _要件: 1.1, 4.4, 6.2, 6.3_

- [x] 5.2 フィルタリングとユーザーインタラクションを実装
  - フィルタ機能（全て/未回答のみ/回答済みのみ）の実装
  - フィルタ状態の管理（useState）
  - フィルタ変更時の即座な結果反映（200ms以内）
  - 調査カードクリック時のナビゲーション処理
  - 回答済み調査クリック時の完了メッセージ表示
  - _要件: 1.3, 2.1, 2.2, 6.4_

- [x] 5.3 エラーハンドリングと再試行機能
  - API障害時のユーザーフレンドリーなエラーメッセージ
  - 再試行ボタンの実装
  - LocalStorage利用不可時の警告メッセージ
  - 空状態時の適切なメッセージ表示
  - _要件: 6.3_

- [ ] 6. ルーティングとナビゲーションを統合
- [x] 6.1 ダッシュボードルートを設定
  - App.tsxの/dashboardルートを更新
  - ProtectedRouteでラップして認証ガード
  - EmployeeDashboardPageコンポーネントの配置
  - 既存のプレースホルダーコードの削除
  - _要件: 4.1, 4.4_

- [x] 6.2 ナビゲーションメニューを更新
  - EmployeeNavigationに「ダッシュボード」メニュー項目を追加
  - アクティブ状態の視覚的表示
  - 管理者権限を持つユーザー向けの管理者ダッシュボード切り替えオプション
  - キーボードナビゲーション対応
  - _要件: 4.2, 4.3, 5.4_

- [ ] 7. アクセシビリティとレスポンシブ対応を実装
- [x] 7.1 ARIA属性とセマンティックHTML
  - 適切なARIAラベルの追加（調査カード、統計カード、フィルタ）
  - セマンティックHTMLタグの使用（nav, main, article, section）
  - スクリーンリーダー対応のラベルとdescription
  - キーボードフォーカス順序の最適化
  - _要件: 5.4, 5.5_

- [x] 7.2 キーボード操作とフォーカス管理
  - すべてのインタラクティブ要素へのキーボードアクセス
  - フォーカス可視化スタイル
  - Enterキーとスペースキーによるアクション実行
  - Tabキーによる論理的なナビゲーション順序
  - _要件: 5.4_

- [ ] 8. ユニットテストを実装
- [ ] 8.1 SessionManager のテストを作成
  - markCompleted機能のテスト
  - isCompleted機能のテスト
  - getSessions機能のテスト
  - cleanup機能のテスト
  - LocalStorage利用不可時のフォールバックテスト
  - _テスト対象: SessionManager_

- [ ] 8.2 useDashboardDataフックのテストを作成
  - 調査データとセッション状態の統合ロジックのテスト
  - 統計情報計算のテスト
  - 期限警告フラグ計算のテスト
  - ローディング・エラーステート処理のテスト
  - React Queryキャッシュ動作のテスト
  - _テスト対象: useDashboardData_

- [ ] 8.3 UIコンポーネントのテストを作成
  - DashboardStatsCardの表示テスト
  - SurveyCardの回答済みバッジ・期限警告バッジ表示テスト
  - SurveyCardListのレスポンシブグリッドテスト
  - 空状態・ローディング状態・エラー状態の表示テスト
  - _テスト対象: DashboardStatsCard, SurveyCard, SurveyCardList_

- [ ] 9. 統合テストを実装
- [ ] 9.1 EmployeeDashboardPageの統合テストを作成
  - ページ全体のレンダリングとレイアウト統合のテスト
  - useDashboardDataフックとのデータ連携テスト
  - フィルタリング機能の動作テスト
  - 調査カードクリック時のナビゲーションテスト
  - エラー状態と空状態の表示テスト
  - _テスト対象: EmployeeDashboardPage統合_

- [ ] 9.2 API + LocalStorage統合テストを作成
  - SurveyServiceからのデータ取得テスト
  - SessionManagerによる状態管理テスト
  - データ統合ロジックの検証テスト
  - エラーリカバリーフローのテスト
  - _テスト対象: API + LocalStorage統合_

- [ ] 10. E2Eテストを実装
- [ ] 10.1 ダッシュボード基本フローのE2Eテストを作成
  - ログイン後のダッシュボード表示テスト
  - 公開中調査一覧の表示テスト
  - 統計情報の計算と表示テスト
  - フィルタリング機能（全て/未回答のみ/回答済みのみ）のテスト
  - _テスト対象: ダッシュボード基本フロー_

- [ ] 10.2 調査回答フローのE2Eテストを作成
  - 未回答調査クリックから調査ページへの遷移テスト
  - 調査完了後のダッシュボードへの自動遷移テスト
  - 回答状態の「回答済み」への更新テスト
  - LocalStorageへの状態永続化テスト
  - _テスト対象: 調査回答フロー_

- [ ] 10.3 レスポンシブデザインとエラーハンドリングのE2Eテストを作成
  - モバイル・タブレット・デスクトップでのグリッドレイアウトテスト
  - 期限警告バッジの表示テスト
  - API障害時のエラーメッセージと再試行テスト
  - LocalStorage無効時の警告表示テスト
  - _テスト対象: レスポンシブ・エラーハンドリング_

- [ ] 11. パフォーマンス最適化と最終調整
- [ ] 11.1 パフォーマンス計測と最適化
  - 初回ロード時間の計測（目標: 2秒以内）
  - フィルタリング応答時間の計測（目標: 200ms以内）
  - React.memoによる不要な再レンダリング防止
  - useMemoとuseCallbackの適切な適用
  - React Queryキャッシュ設定の検証
  - _要件: 6.1, 6.4_

- [ ] 11.2 コード品質とドキュメントの最終確認
  - TypeScript型定義の完全性確認
  - ESLintとPrettierによるコード整形
  - コンポーネントのJSDocコメント追加
  - エラーハンドリングの網羅性確認
  - アクセシビリティチェック（キーボード操作、スクリーンリーダー）
  - _要件: 全要件_
