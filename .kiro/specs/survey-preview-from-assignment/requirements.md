# Requirements Document

## はじめに

本要件は、質問割り当て画面（SurveyQuestionAssignment）に調査プレビュー機能を追加するものです。HR担当者が質問の割り当て作業中に、実際の調査画面がどのように表示されるかをリアルタイムでプレビューできるようにすることで、調査設計の品質向上と作業効率化を実現します。

### ビジネス価値
- **調査品質の向上**: 質問の順序や構成を事前確認し、回答者視点での最適化が可能
- **作業効率の改善**: 別画面への遷移なしで即座にプレビュー確認
- **エラーの早期発見**: 公開前に表示問題や設定ミスを検出

---

## 要件

### 要件1: プレビューボタンの配置
**目的:** HR担当者として、質問割り当て画面から簡単に調査プレビューにアクセスしたい。これにより、作業フローを中断せずにプレビュー確認ができる。

#### 受入基準

1. WHEN HR担当者が質問割り当て画面を表示した時、質問割り当て画面にプレビューボタンが表示される
2. WHEN 調査に1つ以上の質問が割り当てられている時、プレビューボタンは有効状態である
3. WHEN 調査に質問が1つも割り当てられていない時、プレビューボタンは無効状態であり、ツールチップで「質問を割り当ててください」と表示される
4. WHERE プレビューボタンは、質問割り当て画面の上部ヘッダー領域に配置される

---

### 要件2: プレビューモーダルの表示
**目的:** HR担当者として、現在割り当てられている質問で構成された調査画面をプレビュー表示したい。これにより、回答者が実際に見る画面を確認できる。

#### 受入基準

1. WHEN HR担当者がプレビューボタンをクリックした時、調査プレビューモーダルが表示される
2. WHEN プレビューモーダルが表示された時、既存のSurveyPreviewコンポーネントを使用して調査内容がレンダリングされる
3. WHEN プレビューモーダルが表示された時、モーダル背景は半透明のオーバーレイで元の画面を覆う
4. WHEN プレビューモーダルが開いている時、質問割り当て画面はモーダル背後に表示され続ける
5. WHEN プレビューモーダル内で調査情報が表示される時、調査タイトル、説明、期間が表示される

---

### 要件3: プレビュー内容の動的反映
**目的:** HR担当者として、質問の割り当て変更がプレビューに即座に反映されることを期待する。これにより、変更の影響を即座に確認できる。

#### 受入基準

1. WHEN プレビューモーダルが開いている時、現在割り当てられている質問リストの最新状態がプレビューに表示される
2. WHEN プレビューモーダルを閉じて質問の割り当てを変更した後、プレビューモーダルを再度開いた時、変更後の質問構成がプレビューに反映される
3. WHEN 割り当てられた質問の順序が変更された時、プレビューモーダルを再度開くと変更後の順序で質問が表示される
4. WHEN 質問がカテゴリ別に割り当てられている時、プレビューモーダルではカテゴリごとにグループ化して表示される

---

### 要件4: プレビューモーダルの操作
**目的:** HR担当者として、プレビューモーダルを簡単に閉じて質問割り当て作業に戻りたい。これにより、スムーズな作業フローを維持できる。

#### 受入基準

1. WHEN プレビューモーダルが表示されている時、モーダル右上に閉じるボタン（×）が表示される
2. WHEN HR担当者が閉じるボタンをクリックした時、プレビューモーダルが閉じて質問割り当て画面に戻る
3. WHEN HR担当者がモーダル背景（オーバーレイ）をクリックした時、プレビューモーダルが閉じる
4. WHEN HR担当者がESCキーを押した時、プレビューモーダルが閉じる
5. WHEN プレビューモーダルが閉じた時、質問割り当て画面の状態は変更前のまま維持される

---

### 要件5: プレビュー表示モード
**目的:** HR担当者として、回答者が実際に見る画面と同じ形式でプレビューを確認したい。これにより、回答者体験を正確に把握できる。

#### 受入基準

1. WHEN プレビューモーダルが表示される時、既存のSurveyPreviewコンポーネントの「employee」ビューモードが使用される
2. WHEN プレビューモーダル内で質問が表示される時、各質問タイプ（テキスト、Yes/No、多肢選択、評価スケール、評価式）が回答者画面と同じフォーマットで表示される
3. WHEN プレビューモーダル内で質問が表示される時、質問文、必須マーク、回答オプションが表示される
4. WHEN プレビューモーダルが表示される時、実際の回答入力は無効化されており、視覚的プレビューのみ提供される

---

### 要件6: エラーハンドリングとフィードバック
**目的:** HR担当者として、プレビュー機能の状態や問題を明確に把握したい。これにより、適切な対応ができる。

#### 受入基準

1. WHEN プレビューモーダルの読み込み中に、ローディングインジケーターが表示される
2. IF 調査データの取得に失敗した時、プレビューモーダル内にエラーメッセージが表示される
3. WHEN エラーメッセージが表示された時、「再試行」ボタンが提供される
4. IF 質問データの取得に失敗した時、プレビューモーダル内に「質問データを読み込めませんでした」というメッセージが表示される
