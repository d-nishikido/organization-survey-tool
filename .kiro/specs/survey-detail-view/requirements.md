# 要件定義書

## はじめに

調査詳細参照機能は、従業員が公開中の組織サーベイに関する詳細情報を閲覧できる機能を提供します。従業員は調査の目的、質問内容のプレビュー、回答期限、推定所要時間などの情報を確認することで、回答する前に調査の全体像を把握し、適切なタイミングで回答を開始できるようになります。完全匿名性を維持しながら、従業員の調査理解度を向上させ、より質の高い回答を促進します。

## 要件

### 要件1: 調査基本情報の表示

**目的:** 一般従業員として、調査の基本情報を確認できるようにしたい。そうすることで、調査の目的と概要を理解し、回答するかどうかを判断できる。

#### 受入基準

1. WHEN 従業員が調査詳細ページにアクセスした THEN 調査詳細ビュー SHALL 調査のタイトルを大きく目立つ形で表示する
2. WHEN 調査詳細が表示された THEN 調査詳細ビュー SHALL 調査の説明文を読みやすい形式で表示する
3. WHEN 調査詳細が表示された THEN 調査詳細ビュー SHALL 調査の公開開始日と回答期限を明示する
4. WHEN 調査詳細が表示された THEN 調査詳細ビュー SHALL 推定回答所要時間を表示する（質問数に基づいて計算）
5. IF 調査の期限が3日以内に迫っている THEN 調査詳細ビュー SHALL 期限が近いことを視覚的に強調表示する

### 要件2: 質問内容のプレビュー

**目的:** 一般従業員として、回答前に質問内容を確認できるようにしたい。そうすることで、どのような質問に答える必要があるのかを事前に把握し、準備をした上で回答できる。

#### 受入基準

1. WHEN 調査詳細が表示された THEN 調査詳細ビュー SHALL 調査に含まれる全質問のリストを表示する
2. WHEN 質問リストが表示された THEN 調査詳細ビュー SHALL 各質問について質問文、質問タイプ（自由記述/Yes-No/多肢選択/評価スケール/評価式）、必須/任意の区別を表示する
3. IF 質問がカテゴリ分けされている THEN 調査詳細ビュー SHALL カテゴリごとにグループ化して質問を表示する
4. WHEN 多肢選択式の質問が表示された THEN 調査詳細ビュー SHALL 選択肢の一覧を表示する
5. WHERE 質問数が10問を超える THE 調査詳細ビュー SHALL 質問リストを折りたたみ可能な形式で表示する

### 要件3: 回答状態の確認

**目的:** 一般従業員として、自分がこの調査に回答済みかどうかを確認できるようにしたい。そうすることで、重複回答を避け、未回答の調査に優先的に対応できる。

#### 受入基準

1. WHEN 調査詳細が表示された THEN 調査詳細ビュー SHALL ローカルセッション情報を参照して回答状態（未回答/回答済み）を表示する
2. IF 従業員が既に回答済みである THEN 調査詳細ビュー SHALL 回答完了日時を表示する
3. IF 従業員が未回答である THEN 調査詳細ビュー SHALL 「回答を開始する」ボタンを表示する
4. IF 従業員が既に回答済みである THEN 調査詳細ビュー SHALL 「回答済み」ステータスを明確に表示し、再回答ボタンを非表示にする
5. WHERE セッション情報が存在しない THE 調査詳細ビュー SHALL デフォルトで未回答状態として扱う

### 要件4: 調査への回答開始

**目的:** 一般従業員として、詳細を確認した後にスムーズに回答を開始できるようにしたい。そうすることで、迷うことなく調査に参加できる。

#### 受入基準

1. WHEN 従業員が「回答を開始する」ボタンをクリックした THEN 調査詳細ビュー SHALL 調査回答ページ（/surveys/:id/respond）に遷移する
2. WHEN 回答ページに遷移する THEN 調査詳細ビュー SHALL 調査IDをルートパラメータとして渡す
3. IF 従業員が既に回答済みである THEN 調査詳細ビュー SHALL 回答開始ボタンを無効化し、再回答を防止する
4. WHEN 回答ページへの遷移が発生する THEN 調査詳細ビュー SHALL 現在のページ状態を保持して戻るボタンで復帰可能にする

### 要件5: ナビゲーションとアクセス制御

**目的:** 一般従業員として、調査一覧から詳細ページにアクセスし、必要に応じて他のページに移動できるようにしたい。そうすることで、システム内をスムーズに移動できる。

#### 受入基準

1. WHEN 従業員が調査一覧ページで調査カードをクリックした THEN 調査詳細ビュー SHALL その調査の詳細ページ（/surveys/:id）に遷移する
2. WHEN 調査詳細ページが表示された THEN 調査詳細ビュー SHALL 「一覧に戻る」ナビゲーションリンクを提供する
3. WHEN 「一覧に戻る」リンクがクリックされた THEN 調査詳細ビュー SHALL 調査一覧ページに遷移する
4. WHERE ユーザーがログインしている THE 調査詳細ビュー SHALL 既存のヘッダー・フッター・ナビゲーションコンポーネントと統合する
5. IF 調査IDが存在しない、または公開されていない THEN 調査詳細ビュー SHALL 404エラーページを表示する

### 要件6: レスポンシブデザインとアクセシビリティ

**目的:** 一般従業員として、様々なデバイスから快適に調査詳細を閲覧できるようにしたい。そうすることで、職場でも自宅でも同じように情報を確認できる。

#### 受入基準

1. WHEN 調査詳細がモバイルデバイスで表示された THEN 調査詳細ビュー SHALL 単一カラムレイアウトで情報を表示する
2. WHEN 調査詳細がタブレットで表示された THEN 調査詳細ビュー SHALL 読みやすいレイアウトで情報を表示する
3. WHEN 調査詳細がデスクトップで表示された THEN 調査詳細ビュー SHALL 最適な幅（最大1200px程度）で情報を表示する
4. WHERE ユーザーがキーボード操作のみを使用する THE 調査詳細ビュー SHALL 全ての機能とリンクにキーボードアクセスを提供する
5. WHILE スクリーンリーダーが使用されている THE 調査詳細ビュー SHALL 適切なARIAラベルとセマンティックHTMLで情報を伝達する

### 要件7: パフォーマンスとエラーハンドリング

**目的:** 一般従業員として、高速で信頼性の高い調査詳細表示を利用したい。そうすることで、ストレスなく情報を確認できる。

#### 受入基準

1. WHEN 調査詳細ページが初回ロードされる THEN 調査詳細ビュー SHALL 2秒以内にコンテンツを表示する
2. WHEN 調査データが取得される THEN 調査詳細ビュー SHALL ローディングインジケータを表示してユーザーに進行状況を伝える
3. IF APIリクエストが失敗した THEN 調査詳細ビュー SHALL ユーザーフレンドリーなエラーメッセージと再試行オプションを表示する
4. IF 指定された調査IDが存在しない THEN 調査詳細ビュー SHALL 適切な404エラーメッセージを表示し、調査一覧への戻るリンクを提供する
5. WHEN ネットワークエラーが発生した THEN 調査詳細ビュー SHALL オフライン状態を示すメッセージを表示する

### 要件8: データの取得と表示

**目的:** システムとして、バックエンドAPIから調査の詳細情報を正確に取得し表示できるようにしたい。そうすることで、最新の調査情報を従業員に提供できる。

#### 受入基準

1. WHEN 調査詳細ビューが初期化される THEN 調査詳細ビュー SHALL バックエンドAPI（GET /api/surveys/:id）を呼び出して調査情報を取得する
2. WHEN 調査情報を取得する THEN 調査詳細ビュー SHALL 調査に関連する質問情報も同時に取得する（GET /api/surveys/:id/questions）
3. WHEN APIレスポンスを受信した THEN 調査詳細ビュー SHALL レスポンスデータをZodスキーマで検証する
4. IF APIレスポンスが期待される形式と異なる THEN 調査詳細ビュー SHALL バリデーションエラーを適切にハンドリングする
5. WHERE React Queryを使用している THE 調査詳細ビュー SHALL キャッシュ戦略を適用してパフォーマンスを最適化する
