# 実装計画

## タスク概要

質問タイプの整理と一貫性向上のため、フロントエンドコンポーネントを修正します。共通定数ファイルを作成し、質問タイプラベルの表示を一元化し、不要なタイプを除外し、スケールタイプのデフォルト値を自動設定します。

---

## 実装タスク

- [x] 1. 質問タイプラベルの共通定数ファイルを作成する
- [x] 1.1 アクティブな質問タイプの定義を作成する
  - UI表示用の質問タイプラベルマッピングを定義する（テキスト、単一選択、スケール、はい/いいえなど）
  - 不要な質問タイプ（評価、評価（5段階）、評価（10段階））を除外する
  - はい/いいえタイプを1つのみ含める（booleanのみ、yes_noは除外）
  - TypeScriptの型安全性を活用するためas const修飾子を使用する
  - _要件: 1.1, 1.2, 3.1, 3.2_

- [x] 1.2 レガシー質問タイプの定義を作成する
  - 既存データ表示用のレガシータイプラベルマッピングを定義する（評価（レガシー）、評価（5段階・レガシー）など）
  - レガシーとして明示的にラベル付けし、ユーザーに非推奨であることを伝える
  - yes_noタイプもレガシーマッピングに含める（booleanとの後方互換性のため）
  - _要件: 1.3, 5.1, 5.2_

- [x] 1.3 統一的なラベル取得関数を実装する
  - アクティブタイプとレガシータイプの両方に対応するラベル取得関数を作成する
  - 未知の質問タイプに対してはフォールバック表示を提供する
  - 全画面で一貫した表示を保証する関数シグネチャを定義する
  - 純粋関数として実装し、副作用を持たないようにする
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 2. 質問管理画面を更新する
- [x] 2.1 共通定数をインポートし既存定義を削除する
  - ローカルのQUESTION_TYPES定義を削除する
  - 共通定数ファイルからACTIVE_QUESTION_TYPESとgetQuestionTypeLabelをインポートする
  - 型定義の互換性を確認する
  - _要件: 4.3_

- [x] 2.2 質問タイププルダウンを更新する
  - ACTIVE_QUESTION_TYPESを使用してプルダウン選択肢を生成する
  - 不要な質問タイプがプルダウンに表示されないことを確認する
  - キーと値のマッピングが正しく動作することを確認する
  - _要件: 1.1, 1.2_

- [x] 2.3 質問タイプ選択時のデフォルト値設定を実装する
  - 質問タイプ選択のonChangeハンドラーを更新する
  - スケールタイプが選択された時に最小値1、最大値5を自動設定する
  - 既存の値がある場合は上書きしないロジックを実装する（??演算子を使用）
  - ユーザーがデフォルト値を変更できることを確認する
  - _要件: 2.1, 2.2, 2.3_

- [x] 2.4 既存質問の表示ラベルを更新する
  - 質問リスト表示でgetQuestionTypeLabel関数を使用する
  - レガシータイプの質問が適切なラベルで表示されることを確認する
  - すべての質問タイプ表示箇所を統一する
  - _要件: 1.3, 4.1, 4.2, 5.2_

- [x] 3. 質問バンクコンポーネントを更新する
- [x] 3.1 共通定数をインポートし既存定義を削除する
  - ローカルのQUESTION_TYPES定義を削除する
  - 共通定数ファイルからACTIVE_QUESTION_TYPESとgetQuestionTypeLabelをインポートする
  - 型定義の互換性を確認する
  - _要件: 4.3_

- [x] 3.2 質問タイププルダウンを更新する
  - ACTIVE_QUESTION_TYPESを使用してプルダウン選択肢を生成する
  - はい/いいえタイプが1つのみ表示されることを確認する
  - _要件: 3.1_

- [x] 3.3 質問タイプ選択時のデフォルト値設定を実装する
  - 質問タイプ選択のonChangeハンドラーを更新する
  - スケールタイプが選択された時に最小値1、最大値5を自動設定する
  - 既存の値がある場合は上書きしないロジックを実装する
  - _要件: 2.1, 2.2, 2.3_

- [x] 3.4 既存質問の表示ラベルを更新する
  - 質問リスト表示でgetQuestionTypeLabel関数を使用する
  - すべての質問タイプ表示箇所を統一する
  - _要件: 4.1, 5.2_

- [x] 4. 質問割り当て画面を更新する
- [x] 4.1 共通定数をインポートし既存定義を削除する
  - ローカルのQUESTION_TYPES定義を削除する
  - 共通定数ファイルからgetQuestionTypeLabelをインポートする
  - 型定義の互換性を確認する
  - _要件: 4.3_

- [x] 4.2 質問タイプ表示を統一する
  - 利用可能な質問リストでgetQuestionTypeLabel関数を使用する
  - 割り当て済み質問リストでgetQuestionTypeLabel関数を使用する
  - スケールタイプが「スケール」と正しく表示されることを確認する
  - すべての質問タイプ表示箇所を統一する
  - _要件: 4.1, 4.2, 4.4_

- [x] 5. 単体テストを作成する
- [x] 5.1 共通定数のテストを作成する
  - getQuestionTypeLabel関数が既知の質問タイプに対して正しいラベルを返すことをテストする
  - getQuestionTypeLabel関数が未知の質問タイプに対してフォールバックラベルを返すことをテストする
  - ACTIVE_QUESTION_TYPESに不要なタイプ（rating、rating_5、rating_10）が含まれないことをテストする
  - ACTIVE_QUESTION_TYPESにbooleanのみが含まれyes_noが含まれないことをテストする
  - _要件: 1.1, 1.2, 3.1, 4.1_

- [ ] 5.2 質問管理画面のテストを作成する
  - 質問タイププルダウンに不要なタイプが表示されないことをテストする
  - スケールタイプ選択時にデフォルト値が設定されることをテストする
  - 既存質問の表示時に正しいラベルが表示されることをテストする
  - レガシータイプの質問が適切なラベルで表示されることをテストする
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2, 5.2_

- [ ] 5.3 質問バンクのテストを作成する
  - 質問タイププルダウンにはい/いいえが1つのみ表示されることをテストする
  - スケールタイプ選択時にデフォルト値が設定されることをテストする
  - _要件: 2.1, 2.2, 3.1_

- [ ] 6. E2Eテストを作成する
- [ ] 6.1 質問作成シナリオのテストを作成する
  - 質問管理画面にアクセスし新規質問作成モーダルを開く
  - 質問タイププルダウンに評価タイプが表示されないことを確認する
  - スケールタイプを選択し最小値・最大値フィールドに1、5が自動設定されることを確認する
  - 質問を保存し成功メッセージが表示されることを確認する
  - _要件: 1.1, 1.2, 2.1, 2.2_

- [ ] 6.2 既存質問表示シナリオのテストを作成する
  - テストデータとしてレガシータイプの質問を準備する
  - 質問管理画面で既存質問リストを表示する
  - レガシータイプの質問が適切なラベルで表示されることを確認する
  - レガシータイプの質問を編集可能であることを確認する
  - _要件: 1.3, 5.1, 5.2_

- [ ] 6.3 質問割り当てシナリオのテストを作成する
  - 質問割り当て画面にアクセスする
  - 利用可能な質問リストでスケールタイプが「スケール」と表示されることを確認する
  - 割り当て済み質問リストでも一貫したラベルが表示されることを確認する
  - _要件: 4.4_

- [ ] 7. 型チェックとリントを実行する
- [ ] 7.1 TypeScriptの型チェックを実行する
  - フロントエンドディレクトリでnpm run type-checkを実行する
  - すべての型エラーを解決する
  - 共通定数ファイルの型定義が正しくエクスポートされていることを確認する
  - _要件: すべての要件（型安全性の保証）_

- [ ] 7.2 ESLintとPrettierを実行する
  - フロントエンドディレクトリでnpm run lintを実行する
  - すべてのリントエラーを解決する
  - コードフォーマットを統一する
  - _要件: すべての要件（コード品質の保証）_

- [ ] 8. 統合テストを実行する
- [ ] 8.1 質問作成フローの統合テストを実行する
  - 質問管理画面でスケール質問を作成する
  - デフォルト値が正しくバックエンドに送信されることを確認する
  - データベースに正しく保存されることを確認する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 8.2 質問編集フローの統合テストを実行する
  - 既存のレガシータイプ質問を編集する
  - 質問タイプの表示ラベルが正しいことを確認する
  - 編集内容が正しく保存されることを確認する
  - _要件: 1.3, 5.1, 5.2_

- [ ] 8.3 質問割り当てフローの統合テストを実行する
  - 質問割り当て画面で質問タイプラベルが統一されていることを確認する
  - 質問の割り当て・解除が正常に動作することを確認する
  - _要件: 4.1, 4.2, 4.3, 4.4_

---

## 要件カバレッジチェックリスト

- [x] 要件1.1: 質問管理画面のプルダウンから不要なタイプを除外（タスク1.1, 2.2, 5.1, 6.1）
- [x] 要件1.2: 質問作成モーダルのプルダウンから不要なタイプを除外（タスク1.1, 2.2, 6.1）
- [x] 要件1.3: 既存質問の表示と編集（タスク1.2, 2.4, 5.2, 6.2, 8.2）
- [x] 要件1.4: バックエンドバリデーション（変更なし、既存機能で対応）
- [x] 要件2.1: スケール選択時に最小値1を自動設定（タスク2.3, 3.3, 5.2, 5.3, 6.1, 8.1）
- [x] 要件2.2: スケール選択時に最大値5を自動設定（タスク2.3, 3.3, 5.2, 5.3, 6.1, 8.1）
- [x] 要件2.3: デフォルト値の変更保持（タスク2.3, 3.3, 8.1）
- [x] 要件2.4: バリデーション強化（既存機能で対応）
- [x] 要件3.1: はい/いいえを1つのみ表示（タスク1.1, 3.2, 5.1, 5.3）
- [x] 要件3.2: 内部的にyes_noとbooleanをサポート（タスク1.1, 1.2）
- [x] 要件3.3: 一貫した内部タイプ値で保存（既存機能で対応）
- [x] 要件4.1: 質問管理画面でスケールを正しく表示（タスク1.3, 2.4, 5.2）
- [x] 要件4.2: 評価（10段階）と誤って表示しない（タスク1.3, 4.2）
- [x] 要件4.3: 全箇所で一貫した表示名を使用（タスク1.3, 2.1, 3.1, 4.1）
- [x] 要件4.4: 質問割り当て画面でスケールを正しく表示（タスク4.2, 6.3, 8.3）
- [x] 要件5.1: 既存データの保持（タスク1.2, 6.2, 8.2）
- [x] 要件5.2: 既存質問の適切なラベル表示（タスク1.2, 2.4, 3.4, 5.2, 6.2, 8.2）
- [x] 要件5.3: 既存回答データの保持（変更なし、既存機能で対応）
- [x] 要件5.4: 新規作成のみ禁止、既存データ読み取り許可（タスク1.1, 1.2で実現）
